<!DOCTYPE html>
<html>
<head>
  <title>Global Warming Quiz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    .center-screen {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: #eaf5ea;
      padding: 20px;
      box-sizing: border-box;
      text-align: center;
      user-select: none;
    }
    .quiz-container {
      display: none;
      margin: 40px auto;
      max-width: 800px;
      user-select: none;
    }
    h2 {
      color: #2e8b57;
      user-select: none;
    }
    .timer, #startCountdown {
      font-size: 1.5em;
      font-weight: bold;
      color: #b22222;
      margin-bottom: 15px;
      user-select: none;
    }
    .question {
      margin-bottom: 20px;
      user-select: none;
    }
    .feedback {
      font-weight: bold;
      margin-top: 5px;
      user-select: none;
    }
    .correct {
      color: #2e8b57;
      user-select: none;
    }
    .incorrect {
      color: #d2691e;
      user-select: none;
    }
    .result {
      font-weight: bold;
      color: #d2691e;
      margin-top: 20px;
      user-select: none;
    }
    button {
      margin-top: 20px;
      font-size: 1.1em;
      padding: 10px 20px;
      cursor: pointer;
      user-select: none;
    }
    button.disabled {
      pointer-events: none;
      opacity: 0.6;
    }
    ul {
      text-align: left;
      display: inline-block;
      margin: 0 auto;
      padding-left: 20px;
      user-select: none;
    }
    #tabSwitchWarning, #deviceNotice, #inputError {
      color: #d2691e;
      font-weight: bold;
      margin-top: 15px;
      user-select: none;
    }
    #deviceNotice {
      margin-top: 20px;
    }
    input[type="text"], input[type="email"] {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
      margin-bottom: 15px;
      user-select: text; /* allow selection for input fields */
    }
  </style>
</head>
<body>
  <!-- Intro Screen -->
  <div class="center-screen" id="introScreen">
    <h1>Welcome to the Global Warming Quiz</h1>
    <p>You are about to take a quiz on <b>global warming</b>.</p>

    <p><b>Rules:</b></p>
    <ul>
      <li>You will have <b>4 minutes</b> to complete 10 questions.</li>
      <li>The quiz will begin in fullscreen mode to ensure fairness.</li>
      <li><b>If you exit fullscreen at any time, the quiz will be automatically submitted immediately.</b></li>
      <li><b>Tab switching is strictly prohibited.</b> If you switch tabs or change the browser window, the quiz will be submitted.</li>
      <li><b>Copying of quiz content is disabled.</b></li>
      <li><b>Inspecting or altering the page source is not allowed.</b></li>
    </ul>

    <p id="tabSwitchWarning">
      ⚠️ This quiz is protected against cheating. Please remain on this tab and stay in fullscreen mode until you finish the quiz.
    </p>

    <!-- Countdown to quiz start -->
    <div id="startCountdown">
      Quiz starts in: calculating...
    </div>

    <!-- Device notice -->
    <div id="deviceNotice">
      ⚠️ This quiz can only be attempted on a laptop or desktop PC.
    </div>

    <!-- Input fields for name and email -->
    <div style="margin-top: 20px; text-align: left; max-width: 400px; width: 100%;">
      <label for="userName" style="font-weight: bold;">Name:</label><br/>
      <input type="text" id="userName" name="userName" placeholder="Enter your full name" autocomplete="off" /><br/>
      <label for="userEmail" style="font-weight: bold;">Email Address:</label><br/>
      <input type="email" id="userEmail" name="userEmail" placeholder="Enter your email address" autocomplete="off" />
    </div>

    <div id="inputError" style="display:none;"></div>

    <button id="startBtn" onclick="startQuiz()">Start Quiz</button>
  </div>

  <!-- Quiz Container -->
  <div class="quiz-container" id="quizContainer">
    <h2>Global Warming Quiz</h2>
    <div class="timer" id="timer">Time left: 04:00</div>
    <form id="quizForm">
      <div class="question" id="qdiv1">
        <p>1. What is the primary gas responsible for global warming?</p>
        <input type="radio" name="q1" value="a" /> Oxygen<br />
        <input type="radio" name="q1" value="b" /> Nitrogen<br />
        <input type="radio" name="q1" value="c" /> Carbon Dioxide<br />
        <input type="radio" name="q1" value="d" /> Hydrogen<br />
        <div class="feedback" id="feedback1"></div>
      </div>
      <div class="question" id="qdiv2">
        <p>2. Which process releases the most greenhouse gases?</p>
        <input type="radio" name="q2" value="a" /> Photosynthesis<br />
        <input type="radio" name="q2" value="b" /> Combustion of Fossil Fuels<br />
        <input type="radio" name="q2" value="c" /> Evaporation<br />
        <input type="radio" name="q2" value="d" /> Freezing<br />
        <div class="feedback" id="feedback2"></div>
      </div>
      <div class="question" id="qdiv3">
        <p>3. Which sector is the largest source of global greenhouse gas emissions?</p>
        <input type="radio" name="q3" value="a" /> Transportation<br />
        <input type="radio" name="q3" value="b" /> Agriculture<br />
        <input type="radio" name="q3" value="c" /> Energy Production<br />
        <input type="radio" name="q3" value="d" /> Waste Management<br />
        <div class="feedback" id="feedback3"></div>
      </div>
      <div class="question" id="qdiv4">
        <p>4. Which international agreement seeks to limit global temperature rise?</p>
        <input type="radio" name="q4" value="a" /> Paris Agreement<br />
        <input type="radio" name="q4" value="b" /> Montreal Protocol<br />
        <input type="radio" name="q4" value="c" /> Kyoto Protocol<br />
        <input type="radio" name="q4" value="d" /> Geneva Convention<br />
        <div class="feedback" id="feedback4"></div>
      </div>
      <div class="question" id="qdiv5">
        <p>5. What is the main effect of global warming on sea levels?</p>
        <input type="radio" name="q5" value="a" /> Decrease<br />
        <input type="radio" name="q5" value="b" /> No Change<br />
        <input type="radio" name="q5" value="c" /> Increase<br />
        <input type="radio" name="q5" value="d" /> Seasonal Variation Only<br />
        <div class="feedback" id="feedback5"></div>
      </div>
      <div class="question" id="qdiv6">
        <p>6. Which renewable energy source does NOT emit greenhouse gases during operation?</p>
        <input type="radio" name="q6" value="a" /> Solar<br />
        <input type="radio" name="q6" value="b" /> Coal<br />
        <input type="radio" name="q6" value="c" /> Natural Gas<br />
        <input type="radio" name="q6" value="d" /> Diesel<br />
        <div class="feedback" id="feedback6"></div>
      </div>
      <div class="question" id="qdiv7">
        <p>7. Which is a climate change mitigation strategy?</p>
        <input type="radio" name="q7" value="a" /> Deforestation<br />
        <input type="radio" name="q7" value="b" /> Planting Trees<br />
        <input type="radio" name="q7" value="c" /> Burning More Coal<br />
        <input type="radio" name="q7" value="d" /> Building Highways<br />
        <div class="feedback" id="feedback7"></div>
      </div>
      <div class="question" id="qdiv8">
        <p>8. What is the term for the gradual rise in Earth's average temperature?</p>
        <input type="radio" name="q8" value="a" /> Global Cooling<br />
        <input type="radio" name="q8" value="b" /> Global Warming<br />
        <input type="radio" name="q8" value="c" /> Erosion<br />
        <input type="radio" name="q8" value="d" /> Sedimentation<br />
        <div class="feedback" id="feedback8"></div>
      </div>
      <div class="question" id="qdiv9">
        <p>9. Which activity can help reduce your personal carbon footprint?</p>
        <input type="radio" name="q9" value="a" /> Using public transport<br />
        <input type="radio" name="q9" value="b" /> Driving alone daily<br />
        <input type="radio" name="q9" value="c" /> Leaving lights on<br />
        <input type="radio" name="q9" value="d" /> Littering<br />
        <div class="feedback" id="feedback9"></div>
      </div>
      <div class="question" id="qdiv10">
        <p>10. What can melting polar ice caps cause?</p>
        <input type="radio" name="q10" value="a" /> Sea level rise<br />
        <input type="radio" name="q10" value="b" /> Air temperature drop<br />
        <input type="radio" name="q10" value="c" /> Less ocean water<br />
        <input type="radio" name="q10" value="d" /> More deserts<br />
        <div class="feedback" id="feedback10"></div>
      </div>
      <button type="button" id="submitBtn" onclick="checkAnswers()">Submit Answers</button>
    </form>
    <div class="result" id="result"></div>
  </div>

<script>
  let timer = 240; // seconds - quiz duration timer
  let timerInterval;
  let quizSubmitted = false;
  let quizStarted = false; // flag for scheduled auto start

  // Scheduled start time: Sunday 3 August 2025 22:40 IST = 17:10 UTC
  // Note: Month is zero-based (7 = August)
  const quizStartUTC = Date.UTC(2025, 7, 3, 17, 10, 0);

  // Device check: returns true if desktop/laptop, false for mobile/tablet
  function isDesktopUser() {
    const ua = navigator.userAgent.toLowerCase();
    const isMobile = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/.test(ua);
    const isTablet = /tablet|ipad/.test(ua);
    return !(isMobile || isTablet);
  }

  // Update countdown until quiz start
  function updateStartCountdown() {
    const now = new Date().getTime();
    const distance = quizStartUTC - now;
    const countdownEl = document.getElementById("startCountdown");
    const startBtn = document.getElementById("startBtn");
    const inputError = document.getElementById("inputError");

    if(distance > 0) {
      startBtn.disabled = true;
      inputError.style.display = "none";

      // Calculate time components
      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);

      countdownEl.textContent = `Quiz starts in: ${days}d ${hours}h ${minutes}m ${seconds}s`;

    } else {
      countdownEl.textContent = "Quiz is now available!";
      startBtn.disabled = false;

      // If quiz not started, optionally auto-start
      if(!quizStarted) {
        quizStarted = true;
        // You can comment out the next line if you want user to click Start button manually
        // startQuiz();
      }
    }
  }

  // Disable right-click anywhere
  document.addEventListener('contextmenu', e => { e.preventDefault(); return false; });

  // Disable text selection
  document.addEventListener('selectstart', e => { e.preventDefault(); return false; });

  // Disable broad keyboard shortcuts only during quiz
  let keyboardBlocked = false;
  function keyboardBlocker(e) { e.preventDefault(); return false; }
  function enableKeyboardBlock() {
    if (!keyboardBlocked) {
      document.addEventListener('keydown', keyboardBlocker, true);
      keyboardBlocked = true;
    }
  }
  function disableKeyboardBlock() {
    if (keyboardBlocked) {
      document.removeEventListener('keydown', keyboardBlocker, true);
      keyboardBlocked = false;
    }
  }

  // Fullscreen request
  function goFullScreen(elem) {
    if (elem.requestFullscreen) elem.requestFullscreen();
    else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
    else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
  }

  // Auto-submit on fullscreen exit
  function autoSubmitQuizOnFullScreenExit() {
    if (quizSubmitted) return;
    alert('You exited fullscreen. The quiz will now be submitted.');
    checkAnswers(true);
  }
  document.addEventListener('fullscreenchange', () => {
    if (!document.fullscreenElement && document.getElementById('quizContainer').style.display === 'block') {
      autoSubmitQuizOnFullScreenExit();
    }
  });

  // Auto-submit on tab switch or window minimize
  document.addEventListener('visibilitychange', () => {
    if (!quizSubmitted && document.getElementById('quizContainer').style.display === 'block' && document.hidden) {
      alert('You switched tabs or minimized the browser. The quiz will now be submitted.');
      checkAnswers(true);
    }
  });

  function startQuiz() {
    const nameInput = document.getElementById('userName').value.trim();
    const emailInput = document.getElementById('userEmail').value.trim();
    const errorDiv = document.getElementById('inputError');

    // Device check
    if (!isDesktopUser()) {
      errorDiv.textContent = "Please use a laptop or desktop PC to attempt this quiz.";
      errorDiv.style.display = "block";
      return;
    }

    // Check time if quiz start time has passed
    if (new Date().getTime() < quizStartUTC) {
      errorDiv.textContent = "The quiz has not started yet. Please wait for the scheduled time.";
      errorDiv.style.display = "block";
      return;
    }

    if (nameInput === '') {
      errorDiv.textContent = "Please enter your name.";
      errorDiv.style.display = "block";
      return;
    }
    if (emailInput === '') {
      errorDiv.textContent = "Please enter your email address.";
      errorDiv.style.display = "block";
      return;
    }
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailPattern.test(emailInput)) {
      errorDiv.textContent = "Please enter a valid email address.";
      errorDiv.style.display = "block";
      return;
    }

    errorDiv.style.display = "none";

    document.getElementById('introScreen').style.display = 'none';
    document.getElementById('quizContainer').style.display = 'block';

    timer = 240;
    quizSubmitted = false;
    startTimer();
    goFullScreen(document.documentElement);
    enableKeyboardBlock();
  }

  function startTimer() {
    updateTimerDisplay();
    timerInterval = setInterval(() => {
      timer--;
      updateTimerDisplay();
      if (timer <= 0) {
        clearInterval(timerInterval);
        if (!quizSubmitted) {
          checkAnswers(true);
        }
      }
    }, 1000);
  }

  function updateTimerDisplay() {
    const min = Math.floor(timer / 60);
    const sec = timer % 60;
    document.getElementById('timer').textContent =
      `Time left: ${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
  }

  // Send quiz result to Web3Forms API
  function sendToWeb3Forms(name, email, score) {
    const endpoint = "https://api.web3forms.com/submit";

    const data = {
      access_key: "f865382d-acee-4a3a-a8d7-3246c243f489",  // <-- REPLACE with your Web3Forms access key
      name: name,
      email: email,
      score: score
    };

    fetch(endpoint, {
      method: "POST",
      headers: { "Content-Type": "application/json", Accept: "application/json" },
      body: JSON.stringify(data),
    })
    .then(response => response.json())
    .then(json => {
      if (json.success) {
        console.log("Quiz result sent to Web3Forms.");
      } else {
        console.error("Web3Forms submission failed:", json.message);
      }
    })
    .catch(error => {
      console.error("Web3Forms submission error:", error);
    });
  }

  function checkAnswers(auto = false) {
    if (quizSubmitted) return;

    const answers = ['c', 'b', 'c', 'a', 'c', 'a', 'b', 'b', 'a', 'a'];
    const ansText = [
      "Carbon Dioxide",
      "Combustion of Fossil Fuels",
      "Energy Production",
      "Paris Agreement",
      "Increase",
      "Solar",
      "Planting Trees",
      "Global Warming",
      "Using public transport",
      "Sea level rise",
    ];

    let score = 0;
    let allAnswered = true;

    for (let i = 1; i <= 10; i++) {
      document.getElementById('feedback' + i).innerHTML = "";
      const radios = document.getElementsByName('q' + i);
      let answered = false;
      let userVal = "";

      for (const radio of radios) {
        if (radio.checked) {
          answered = true;
          userVal = radio.value;
          if (radio.value === answers[i - 1]) score++;
        }
      }

      if (!answered) allAnswered = false;

      if (userVal === answers[i - 1]) {
        document.getElementById('feedback' + i).innerHTML = "<span class='correct'>Correct!</span>";
      } else {
        document.getElementById('feedback' + i).innerHTML =
          "<span class='incorrect'>Incorrect. Correct answer: <b>" + ansText[i - 1] + "</b></span>";
      }
    }

    if (!allAnswered && !auto) {
      document.getElementById('result').textContent = "Please answer all questions!";
      for(let j=1; j<=10; j++) {
        const fb = document.getElementById('feedback'+j);
        if(fb) fb.innerHTML = "";
      }
      return;
    }

    quizSubmitted = true;
    clearInterval(timerInterval);

    Array.from(document.querySelectorAll('input[type=radio]')).forEach(e => e.disabled = true);
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = true;
    submitBtn.classList.add('disabled');

    disableKeyboardBlock();

    const name = document.getElementById('userName').value.trim();
    const email = document.getElementById('userEmail').value.trim();

    // Submit data to Web3Forms
    sendToWeb3Forms(name, email, score);

    if (auto && !allAnswered) {
      document.getElementById('result').textContent =
        "Time's up or quiz submitted early! You scored " + score + " out of 10.";
    } else {
      document.getElementById('result').textContent = "You scored " + score + " out of 10.";
    }
  }

  // Update intro countdown every 1 second
  setInterval(updateStartCountdown, 1000);

  window.onload = function() {
    document.getElementById('quizContainer').style.display = 'none';
    document.getElementById('introScreen').style.display = 'flex';
    updateStartCountdown(); // initial call to show countdown immediately
  };
</script>
</body>
</html>
